# Sample test directories

<!-- vim-markdown-toc GFM -->

* [simp_conf.yaml](#simp_confyaml)
  * [Settings that are overridden by `packer.yml`](#settings-that-are-overridden-by-packeryml)
* [vars.json](#varsjson)
* [packer.yaml](#packeryaml)
  * [Provisioning Overrides](#provisioning-overrides)

<!-- vim-markdown-toc -->

Each test directory should contain 3 files:

## simp_conf.yaml

This is a YAML answers file for `simp config`.  This is the basis for the
the answers file that will be input to **`simp config`**  when packer
provisions the SIMP server.


### Settings that are overridden by `packer.yml`

**NOTE:** The following settings in `simp_conf.yaml` are overridden based on
the settings in [packer.yaml](#packer_yaml):

    cli::network::gateway
    cli::network::hostname
    cli::network::interface
    cli::network::ipaddress
    cli::network::netmask
    simp_options::fips
    simp_options::dns::search
    simp_options::dns::servers
    simp_options::ldap::base_dn
    simp_options::ntpd::servers
    simp_options::puppet::server
    simp_options::puppet::ca
    simp_options::trusted_nets


## vars.json

JSON file, generated by `build:auto` during a SIMP ISO build.  It points to the
location of the ISO, the checksum and the name of the distribution ISO.

**NOTE:** The keys `new_password` and `output directory` are ignored in
favor of the `simp-packer` defaults.


## packer.yaml

YAML file with provisioning overrides.  Each provisioning override
(listed below) has a default value that will applied if the tag is not
present in this YAML.  However, even if no custom values are to be
specified, this file must be present.

* The defaults are set in [`simp_config.rb`](../simp_config.rb).
* All values are Strings.
* At this time, no validation of values is done.

### Provisioning Overrides

```yaml
# The name/description of the machine.  It is used to create files and
# directories, so use only letters, numbers, '-', ',' or '_'.
vm_description: 'SIMP-PACKER-BUILD'

# Fully qualified path to the directory you want to place your output.
# The system will create a timestamp directory in here to place
# the data.
output_directory: '/var/user1/OUTPUT'

# The NAT interface that is used by vagrant.
# It must be the first interface
# On Centos 6 it should be eth0, on CentOS 7 enp0s3 works in most cases
# NOTE:  the MAC for this interface is auto-generated.
nat_interface: 'enp0s3'

# The next 4 parameters pertain to configuration of the host-only interface.
# The machine will have a second interface for a host-only VirtualBox network.
# This network must already be setup on your system before you run this
# packer build.  The packer build will NOT create it for you.
# This host-only network must be a class C IPv4 network, currently, because
# 1) the netmask is hardcoded to 255.255.255.0
# 2) the puppet master IP is created by taking the first three octets of
#    the gateway address and adding .7
# 3) the DHCP and DNS configurations are created for a set of workstations
#    and servers whose IPs are in the range [first three octets + .20] to
     [first three octets + .39]

# The interface used on the system for the host-only network
# CentOS 6 it should be 'eth1', on CentOS 7 enp0s8 works in most cases
host_only_interface: 'enp0s8'

# The MAC address of the host-only interface.
# The MAC addresses for the set of servers and workstations in the
# generated DHCP configuration are comprised of the first 10 characters
# (hex #s) of this MAC address plus the numbers 21 - 39.
mac_address: 'aabbbbaa0007'

# The gateway is the router address.  It will check if you have
# a VirtualBox network with this gateway and if not create one.
# (It does not delete it when finished at this time.)
host_only_gateway: '192.168.101.1'


# Domain to which the host belongs.  Will be used to set server's network domain
# and FQDN.
domain: 'simp.test'

# Host name of the server, will be appended to 'domain' for full name.
puppetname': 'puppet',

# This will be the password for the root, simp and LDAP root.
#  (new_password in the vars.json file is ignored.)
# FIXME: This doesn't work for the LDAP root password, at this time (sorry)
new_password: 'P@ssw0rdP@ssw0rd',

# Whether to set up the system with FIPS enabled.
# Default is 'fips=0' which turns FIPS off.
fips: 'fips=1'

# Whether to encrypt the disk at build time
# Valid values:
#   '' to not encrypt
#  'simp_crypt_disk' or 'simp_disk_crypt' to encrypt the disk
#  This is used in diskdetect script in the ks directory.
disk_encrypt: ''

# Additional sleep to add to the time allotted to boot from the ISO.
# You may need to customize this if your build environment runs slower
# than than the environment used to develop this packer build and test
# capability. Should be a sequence of <wait10> strings (10 second wait
# commands allowed by packer).
#
# NOTE:
# (1) You need to use double quotes around the value if it contains one
#     or more <wait10> strings. Packer will fail with a keyboard input
#     error if you use single quotes.
# (2) The default is '', no extra time.
big_sleep: "<wait10><wait10><wait10>"

# The value of root's umask, set in /root/.bash_profile prior to simp config.
# Setting this to '0077' tests that SIMP can be bootstrapped when the
# SIMP host has this lockdown already in place.  A value of '' leaves
# the umask unchanged.
root_umask: '0077'

# The type of firmware used to boot the system
# Valid values: 'bios' or 'efi'
firmware: 'bios'

# Whether or not to bring up the console.  It must be set to false if you
# running this on a system without a GUI.
# Valid values:  true or false
headless: 'true'

# If found, the distribution ISO will be unpacked into the yum repository.
# The name of the ISO is the "box_distro_release" variable set by simp_rake_helpers
# in the vars.json file. The directory where this is can be found is set by the
# iso_dist_dir variable in the packer file.
iso_dist_dir: /net/ISO/Distribution_ISOs
```
